# 개발된 소프트웨어

## 1. RAG (Retrieval-Augmented Generation) 시스템

### 구현 위치
- **디렉토리**: `back-end/zip_fit/`
- **주요 파일**: `chatting.py`, `llm_handler.py`, `gongo.py`

### 주요 구성요소

#### 질문 재구성 (Query Rewriting)
- **구현**: `llm_handler.py` - `rewrite_query()`
- **기능**: 사용자의 모호한 질문을 검색에 적합한 형태로 변환
- **추출 정보**:
  - 지역 (region)
  - 공고 유형 (notice_type)
  - 카테고리 (category: lease/sale)
  - 재구성된 질문 (rewritten_question)
  - 검색 키워드 (search_keywords)

#### 멀티쿼리 생성 (Multi-Query Generation)
- **구현**: `llm_handler.py` - `generate_multi_queries()`
- **기능**: 원본 질문을 다양한 표현으로 변환하여 검색 범위 확대
- **생성 개수**: 기본 2개의 추가 쿼리 생성

#### 하이브리드 검색 (Hybrid Search)
- **구현**: `gongo.py` - `multi_query_hybrid_search()`
- **구성 요소**:
  - **벡터 검색**: 의미 기반 유사도 검색 (`vector_search()`)
  - **키워드 검색**: 정확한 단어 매칭 (`keyword_search()`)
- **필터링**: 지역, 유형, 카테고리별 필터링 지원
- **맥락 인식**: 이전 대화에서 언급된 공고 ID 범위 내 검색

#### 재순위화 (Reranking)
- **구현**: `gongo.py` - `rerank_results()`
- **모델**: Dongjin-kr/ko-reranker (Cross-Encoder)
- **기능**: 초기 검색 결과를 질문과의 관련도에 따라 재정렬
- **설정**: `USE_RERANKER` 환경 변수로 활성화/비활성화 가능

#### 청크 병합 (Chunk Merging)
- **구현**: `gongo.py` - `merge_chunks()`
- **기능**: 동일 공고의 여러 청크를 하나로 병합
- **정렬**: 청크 인덱스 순서로 정렬하여 문맥 유지

#### 컨텍스트 구성 (Context Building)
- **구현**: `gongo.py` - `build_context()`
- **기능**: 검색된 공고 정보를 구조화된 형식으로 구성
- **포함 정보**: 공고 제목, 지역, 유형, 관련도 점수, 문서 내용

#### 답변 생성 (Answer Generation)
- **구현**: `llm_handler.py` - `generate_answer()`
- **모델**: GPT-4o-mini
- **기능**: 제공된 컨텍스트를 바탕으로 사용자 질문에 대한 답변 생성
- **특징**:
  - 문서 기반 정확한 답변
  - 전문 용어 쉬운 설명
  - 표 및 목록 형식 정리
  - 출처 명시

### 맥락 인식 대화 (Context-Aware Chat)
- **구현**: `chatting.py` - `chat_service()`
- **기능**: 현재 질문이 이전 대화와 이어지는지 판단하여 처리 방식 결정
- **전략**:
  - 맥락 질문인 경우: 이전에 언급된 공고 ID 범위 내에서 우선 검색
  - 일반 질문인 경우: 전체 데이터베이스에서 검색

---

## 2. LLM 통합

### 구현 위치
- **파일**: `back-end/zip_fit/llm_handler.py`

### 주요 기능

#### 질문 분석 및 재구성
- **함수**: `rewrite_query()`
- **모델**: GPT-4o-mini
- **Temperature**: 0 (정확한 분석)
- **출력 형식**: JSON

#### 맥락 분석
- **함수**: `analyze_context()`
- **기능**: 현재 질문이 이전 대화에서 언급된 특정 공고를 지칭하는지 판단
- **출력**: 맥락 질문 여부, 참조 공고 인덱스

#### 답변 생성
- **함수**: `generate_answer()`
- **모델**: GPT-4o-mini
- **Temperature**: 0.1 (일관된 답변)
- **Max Tokens**: 2000
- **시스템 프롬프트**: LH 공사 임대/분양 공고 전문 상담사 역할

---

## 3. Vector Database 연동

### 구현 위치
- **파일**: `back-end/zip_fit/gongo.py`

### 주요 기능

#### 벡터 유사도 검색
- **함수**: `vector_search()`
- **연산자**: pgvector의 cosine distance (`<=>`)
- **필터링**: 지역, 유형, 카테고리, 공고 ID별 필터링 지원
- **정렬**: 유사도 점수 기준 내림차순

#### 키워드 검색
- **함수**: `keyword_search()`
- **방법**: LIKE 연산자를 사용한 부분 문자열 매칭
- **특징**: 정확한 단어 매칭에 유리

#### 하이브리드 검색
- **함수**: `multi_query_hybrid_search()`
- **전략**: 벡터 검색과 키워드 검색 결과 병합
- **중복 제거**: 동일 청크 ID는 한 번만 포함

#### 재순위화
- **함수**: `rerank_results()`
- **방법**: Cross-Encoder 모델을 사용한 점수 재계산
- **정렬**: Rerank 점수 기준 내림차순 정렬

---

## 4. 세션 관리

### 구현 위치
- **파일**: `back-end/zip_fit/router.py`

### 기능
- 사용자별 대화 세션 관리
- 대화 내역 저장 및 조회
- 세션 초기화 기능

### 저장 정보
- 사용자 질문
- 생성된 답변
- 참조된 공고 소스

---

## 5. Frontend 애플리케이션

### 구현 위치
- **디렉토리**: `front-end/zf_front/`

### 기술 스택
- **프레임워크**: Vue 3
- **빌드 도구**: Vite
- **언어**: TypeScript
- **상태 관리**: Pinia
- **라우팅**: Vue Router

### 주요 기능

#### AI 채팅 인터페이스
- **파일**: `src/views/AiView.vue`
- **기능**:
  - 실시간 채팅 인터페이스
  - 메시지 히스토리 표시
  - 로딩 상태 표시

#### 공고 리스트 조회
- **파일**: `src/views/ListView.vue`
- **기능**: LH, SH, GH 최신 공고 리스트 조회

#### 대시보드 통계
- **파일**: `src/views/HomeView.vue`
- **기능**:
  - 전체 공고 수 통계
  - 진행 중 공고 수
  - 접수 중 공고 수
  - 기타 상태 공고 수

### API 연동
- **엔드포인트**: `/api/v1/chat`
- **요청 형식**: JSON
- **응답 형식**: JSON (답변, 소스 정보 포함)

---

## 6. API 서버

### 구현 위치
- **파일**: `back-end/zip_fit/main.py`, `router.py`

### 주요 엔드포인트

#### POST `/api/v1/chat`
- **기능**: RAG 챗봇 메인 엔드포인트
- **요청**: `ChatRequest` (user_id, query)
- **응답**: `ChatResponse` (query, answer, sources, metadata)

#### POST `/api/v1/session/reset`
- **기능**: 세션 초기화
- **요청**: `ResetRequest` (user_id)
- **응답**: 상태 메시지

#### GET `/api/v1/stats`
- **기능**: 대시보드 통계 조회
- **응답**: 공고 통계 정보

#### GET `/`
- **기능**: 헬스 체크
- **응답**: 서비스 상태 및 설정 정보

---

## 7. 성능 최적화

### 비동기 처리
- 모든 I/O 작업은 비동기로 처리 (asyncio, asyncpg)
- 동시 요청 처리 능력 향상

### 모델 캐싱
- 임베딩 모델 및 Reranker 모델은 앱 시작 시 한 번만 로드
- 전역 변수로 관리하여 재사용

### 벡터 검색 최적화
- pgvector 인덱스 활용
- 필터링 조건을 WHERE 절에 적용하여 검색 범위 축소

---

## 8. 주요 파일 구조

```
back-end/zip_fit/
├── main.py              # FastAPI 앱 진입점
├── router.py            # API 라우터 및 세션 관리
├── chatting.py          # RAG 챗봇 서비스 로직
├── llm_handler.py       # LLM 처리 (질문 재구성, 답변 생성)
├── gongo.py            # 벡터 검색 및 DB 연동
├── config.py           # 설정 파일
├── dependencies.py     # 의존성 주입 (모델 로딩)
├── models.py          # Pydantic 모델 정의
└── info.py            # 통계 정보 제공
```

